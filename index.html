<!DOCTYPE html>

<html lang="en">

<head>

  <meta charset="UTF-8">

  <title>获取网格 GeoJSON</title>

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/openlayers/openlayers.github.io@master/en/v6.1.1/css/ol.css"
    type="text/css">

  <script src="https://cdn.jsdelivr.net/gh/openlayers/openlayers.github.io@master/en/v6.1.1/build/ol.js"></script>

  <!-- The line below is only needed for old environments like Internet Explorer and Android 4.x -->

  <script
    src="https://cdn.polyfill.io/v2/polyfill.min.js?features=requestAnimationFrame,Element.prototype.classList,URL"></script>

  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

</head>

<style>
  #map {

    clear: both;

    position: relative;

    width: 100%;

    height: 900px;

    border: 1px solid black;

  }
</style>

<body>

  <input id="coords" style="width: 512px" />

  <div id="map" class="map"></div>

</body>

</html>

<script>



  var projection = ol.proj.get("EPSG:4326");

  var projectionExtent = projection.getExtent();

  var size = ol.extent.getWidth(projectionExtent) / 256;

  var resolutions = new Array(19);

  var matrixIds = new Array(19);

  for (var z = 2; z < 19; ++z) {

    //计算比例尺

    resolutions[z] = size / Math.pow(2, z);

    matrixIds[z] = z;

  }



  var drawVectorSource = new ol.source.Vector({ wrapX: false });

  var labelVectorSource = new ol.source.Vector();

  var map = new ol.Map({

    target: 'map',

    layers: [

      new ol.layer.Tile({

        //矢量地图

        source: new ol.source.WMTS({

          url: "http://t0.tianditu.gov.cn/vec_c/wmts?tk=" + "f4f172b522ca5d236f37f9e016370d8a", //链接需要添加自己申请的密钥

          layer: "vec",

          style: "default",

          matrixSet: "c",

          preload: Infinity,// 提前缓存

          format: "tiles",

          wrapX: true,

          tileGrid: new ol.tilegrid.WMTS({

            origin: ol.extent.getTopLeft(projectionExtent),

            //resolutions: res.slice(0, 15),

            resolutions: resolutions,

            matrixIds: matrixIds

          })

        })

      }),

      new ol.layer.Tile({

        //矢量标注

        source: new ol.source.WMTS({

          url: "http://t0.tianditu.gov.cn/cva_c/wmts?tk=" + "f4f172b522ca5d236f37f9e016370d8a", //链接需要添加自己申请的密钥

          layer: "cva",

          style: "default",

          preload: Infinity,

          matrixSet: "c",

          format: "tiles",

          wrapX: true,

          tileGrid: new ol.tilegrid.WMTS({

            origin: ol.extent.getTopLeft(projectionExtent),

            resolutions: resolutions,

            matrixIds: matrixIds

          })

        })

      }),

      new ol.layer.Vector({

        source: drawVectorSource

      }),

      new ol.layer.Vector({

        source: labelVectorSource

      })

    ],

    view: new ol.View({

      center: [119.34268762076924, 26.06196688300265], //三明市坐标

      zoom: 11,

      projection: 'EPSG:4326'

    })

  });



  var drawTool = new ol.interaction.Draw({

    source: this.drawVectorSource,

    type: 'Point'

  });



  map.addInteraction(drawTool);

  drawVectorSource.on("addfeature", function (evt) {

    var coord = ol.extent.getCenter(evt.feature.getGeometry().getExtent());

    var url = "https://restapi.amap.com/v3/geocode/regeo?key=3e404a1ef889bf56fb77a7b07036070f&location=" +

      coord[0] + "," + coord[1] + "&radius=1000&extensions=base&batch=false";

    axios.get(url).then(function (response) {
      console.log(response, '---------------');
      // var sensors = response.data.regeocode.formatted_address;

      // console.log(sensors + ", " + coord[0] + ", " + coord[1]);

      var feature1 = new ol.Feature({

        geometry: new ol.geom.Point([coord[0], coord[1]])

      });

      // feature1.setStyle(new ol.style.Style({

      //   text: new ol.style.Text({

      //     font: '20px sans-serif',

      //     text: sensors,

      //     offsetY: 20,

      //     fill: new ol.style.Fill({

      //       color: 'red'

      //     })

      //   })

      // }))

      // labelVectorSource.addFeature(feature1);

      document.getElementById("coords").value = coord[0] + ", " + coord[1];

    });

  });



  function clear() {

    drawVectorSource.clear();

    map.render();

  }



</script>